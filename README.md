# ç—…æ¯’ç»„å¹²å®éªŒDemoå®Œæ•´å¯å¤ç”¨è„šæœ¬

**é¡¹ç›®ç›®æ ‡**ï¼šæä¾›ä¸€å¥—å®Œæ•´çš„ç—…æ¯’ç»„å¹²å®éªŒåˆ†ææµç¨‹ï¼ŒåŒ…å«å·¥å…·å®‰è£…ã€æ•°æ®ä¸‹è½½ã€è´¨æ§æ³¨é‡Šã€å¯è§†åŒ–ã€æŠ¥å‘Šæ•´ç†å…¨æµç¨‹ï¼Œå®Œç¾åŒ¹é…æ¢å† ç¿”è¯¾é¢˜ç»„ç—…æ¯’ç»„ç ”ç©¶æ–¹å‘ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šLinux/macOSï¼ˆWindowså¯é€šè¿‡WSL2æ­å»ºç¯å¢ƒï¼‰
- **ç¡¬ä»¶è¦æ±‚**ï¼š8GB+å†…å­˜ï¼Œ4æ ¸+CPUï¼ˆæ¨è16GBå†…å­˜ï¼Œ8æ ¸CPUï¼‰
- **å­˜å‚¨ç©ºé—´**ï¼šè‡³å°‘10GBå¯ç”¨ç©ºé—´

### ä¸€é”®è¿è¡Œï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# 1. å…‹éš†é¡¹ç›®
git clone git@github.com:Tonystarkw12/virus-demo-pipeline.git
cd virus-demo-pipeline

# 2. æ¿€æ´»condaç¯å¢ƒ
conda activate viru_demo

# 3. ä¸€é”®è¿è¡Œæ‰€æœ‰åˆ†ææ­¥éª¤
./scripts/run_all.sh
```

### åˆ†æ­¥è¿è¡Œï¼ˆæ¨èç†Ÿç»ƒè€…ï¼‰

```bash
# æ­¥éª¤1ï¼šç¯å¢ƒè®¾ç½®ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
conda activate viru_demo  # æˆ–å…ˆè¿è¡Œ ./scripts/01_setup_environment.sh

# æ­¥éª¤2ï¼šä¸‹è½½ç—…æ¯’æ•°æ®åº“ï¼ˆçº¦2GBï¼Œé¦–æ¬¡è¿è¡Œï¼‰
./scripts/02_download_database.sh

# æ­¥éª¤3ï¼šä¸‹è½½å…¬å¼€æ•°æ®ï¼ˆçº¦80MBï¼‰
./scripts/03_download_data.sh

# æ­¥éª¤4ï¼šè´¨æ§ä¸å»å†—ä½™
./scripts/04_quality_control.sh

# æ­¥éª¤5ï¼šç‰©ç§æ³¨é‡Š
./scripts/05_annotation.sh

# æ­¥éª¤6ï¼šæ•°æ®å¯è§†åŒ–
Rscript ./scripts/06_visualization.R

# æ­¥éª¤7ï¼šå¡«å†™åˆ†ææŠ¥å‘Š
# å‚è€ƒ reports/report_template.md
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
virus_demo/
â”œâ”€â”€ scripts/                    # åˆ†æè„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ 01_setup_environment.sh # ç¯å¢ƒè®¾ç½®è„šæœ¬
â”‚   â”œâ”€â”€ 02_download_database.sh # æ•°æ®åº“ä¸‹è½½è„šæœ¬
â”‚   â”œâ”€â”€ 03_download_data.sh     # æ•°æ®ä¸‹è½½è„šæœ¬
â”‚   â”œâ”€â”€ 04_quality_control.sh   # è´¨æ§ä¸å»å†—ä½™è„šæœ¬
â”‚   â”œâ”€â”€ 05_annotation.sh        # ç‰©ç§æ³¨é‡Šè„šæœ¬
â”‚   â”œâ”€â”€ 06_visualization.R      # Rå¯è§†åŒ–è„šæœ¬
â”‚   â””â”€â”€ run_all.sh             # ä¸€é”®è¿è¡Œè„šæœ¬
â”œâ”€â”€ reports/                    # æŠ¥å‘Šç›®å½•
â”‚   â””â”€â”€ report_template.md      # åˆ†ææŠ¥å‘Šæ¨¡æ¿
â”œâ”€â”€ virus_data/                 # åŸå§‹æ•°æ®ç›®å½•
â”œâ”€â”€ virus_results/              # åˆ†æç»“æœç›®å½•
â”‚   â”œâ”€â”€ clean_data/            # è´¨æ§ç»“æœ
â”‚   â”œâ”€â”€ non_redundant_data/    # å»å†—ä½™ç»“æœ
â”‚   â””â”€â”€ annotation_results/    # æ³¨é‡Šç»“æœ
â”œâ”€â”€ kraken_viral_db/           # Kraken2ç—…æ¯’æ•°æ®åº“
â””â”€â”€ README.md                  # è¯´æ˜æ–‡æ¡£
```

## âš™ï¸ æ ¸å¿ƒå·¥å…·è¯´æ˜

| å·¥å…· | ç”¨é€” | ç‰ˆæœ¬è¦æ±‚ |
|------|------|----------|
| conda | ç¯å¢ƒç®¡ç† | 4.10+ |
| fastp | åºåˆ—è´¨æ§ | 0.20+ |
| cd-hit | åºåˆ—å»å†—ä½™ | 4.8+ |
| Kraken2 | ç‰©ç§æ³¨é‡Š | 2.1+ |
| MultiQC | è´¨æ§æŠ¥å‘Šæ•´åˆ | 1.12+ |
| R/ggplot2 | æ•°æ®å¯è§†åŒ– | 4.0+ |

## ğŸ“Š é¢„æœŸè¾“å‡º

### è´¨æ§ç±»æ–‡ä»¶
- `virus_results/clean_data/fastp_qc.html` - fastpè´¨æ§æŠ¥å‘Š
- `virus_results/multiqc_report.html` - MultiQCæ±‡æ€»æŠ¥å‘Š

### åºåˆ—ç±»æ–‡ä»¶
- `virus_results/clean_data/clean_virus.fasta` - è´¨æ§ååºåˆ—
- `virus_results/non_redundant_data/non_redundant_virus.fasta` - å»å†—ä½™åºåˆ—

### æ³¨é‡Šç±»æ–‡ä»¶
- `virus_results/annotation_results/kraken_summary_report.txt` - Kraken2æ±‡æ€»æŠ¥å‘Š
- `virus_results/annotation_results/virus_abundance.tsv` - ç—…æ¯’ä¸°åº¦è¡¨æ ¼

### å¯è§†åŒ–å›¾è¡¨
- `virus_results/top10_virus_abundance.pdf` - å‰10ç—…æ¯’ä¸°åº¦æŸ±çŠ¶å›¾
- `virus_results/virus_type_proportion.pdf` - ç—…æ¯’ç±»å‹å æ¯”é¥¼å›¾

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. è·¯å¾„é…ç½®
- æ‰€æœ‰è„šæœ¬é»˜è®¤åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ
- å¦‚éœ€ä¿®æ”¹å·¥ä½œç›®å½•ï¼Œè¯·æ›´æ–°è„šæœ¬ä¸­çš„è·¯å¾„è®¾ç½®

### 2. ç¡¬ä»¶é…ç½®
- **å†…å­˜ä¸è¶³**ï¼šå°†`cd-hit`çš„`-M 16000`å‚æ•°è°ƒæ•´ä¸º`-M 8000`
- **CPUæ ¸å¿ƒæ•°**ï¼šå°†`--threads 8`è°ƒæ•´ä¸ºå®é™…CPUæ ¸å¿ƒæ•°

### 3. ç½‘ç»œé—®é¢˜
- **ä¸‹è½½å¤±è´¥**ï¼šå°è¯•æ›´æ¢ç½‘ç»œæˆ–ä½¿ç”¨ä»£ç†
- **å›½å†…ç”¨æˆ·**ï¼šå¯é…ç½®condaå›½å†…é•œåƒæºåŠ é€Ÿä¸‹è½½

### 4. å¸¸è§é—®é¢˜è§£å†³

#### condaç¯å¢ƒé—®é¢˜
```bash
# æ£€æŸ¥condaæ˜¯å¦æ­£ç¡®å®‰è£…
conda --version

# æ¿€æ´»ç¯å¢ƒ
conda activate viru_demo

# æŸ¥çœ‹ç¯å¢ƒä¸­çš„åŒ…
conda list
```

#### ä¸‹è½½å¤±è´¥é—®é¢˜
```bash
# æ‰‹åŠ¨ä¸‹è½½Miniconda
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh

# æ‰‹åŠ¨ä¸‹è½½ç—…æ¯’æ•°æ®åº“
cd kraken_viral_db
wget https://genome-idx.s3.amazonaws.com/kraken/k2_viral_20240109.tar.gz
```

#### Rè„šæœ¬è¿è¡Œé—®é¢˜
```bash
# æ£€æŸ¥RåŒ…æ˜¯å¦æ­£ç¡®å®‰è£…
R -e "library(ggplot2); library(dplyr); library(tidyr)"

# æ‰‹åŠ¨è¿è¡ŒRè„šæœ¬
Rscript scripts/06_visualization.R
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¡¬ä»¶ä¼˜åŒ–
- **SSDç¡¬ç›˜**ï¼šæ˜¾è‘—æé«˜æ•°æ®è¯»å†™é€Ÿåº¦
- **æ›´å¤šå†…å­˜**ï¼šå¯å¤„ç†æ›´å¤§è§„æ¨¡æ•°æ®é›†
- **å¤šæ ¸CPU**ï¼šå¹¶è¡Œå¤„ç†åŠ é€Ÿåˆ†æ

### 2. å‚æ•°è°ƒä¼˜
- **è´¨é‡é˜ˆå€¼**ï¼šæ ¹æ®æ•°æ®è´¨é‡è°ƒæ•´fastpçš„`-q`å‚æ•°
- **ç›¸ä¼¼åº¦é˜ˆå€¼**ï¼šæ ¹æ®ç ”ç©¶éœ€æ±‚è°ƒæ•´cd-hitçš„`-c`å‚æ•°
- **çº¿ç¨‹æ•°**ï¼šæ ¹æ®ç¡¬ä»¶é…ç½®è°ƒæ•´`--threads`å‚æ•°

## ğŸ¯ åº”ç”¨åœºæ™¯

### é€‚ç”¨ç ”ç©¶
- äººç±»è‚ é“ç—…æ¯’ç»„ç ”ç©¶
- ç¯å¢ƒç—…æ¯’ç»„åˆ†æ
- å™¬èŒä½“ç¾¤è½ç ”ç©¶
- ç—…æ¯’ä¸å®¿ä¸»äº’ä½œç ”ç©¶

### æŠ€æœ¯ä¼˜åŠ¿
- **æ ‡å‡†åŒ–æµç¨‹**ï¼šå¯é‡å¤æ€§é«˜ï¼Œç»“æœå¯é 
- **é«˜æ•ˆåˆ†æ**ï¼šé¢„æ„å»ºæ•°æ®åº“ï¼Œé¿å…10+å°æ—¶æ„å»ºæ—¶é—´
- **å®Œæ•´äº¤ä»˜**ï¼šä»åŸå§‹æ•°æ®åˆ°æœ€ç»ˆæŠ¥å‘Šçš„å…¨æµç¨‹è¦†ç›–

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç³»ç»Ÿç¯å¢ƒæ˜¯å¦ç¬¦åˆè¦æ±‚
2. condaç¯å¢ƒæ˜¯å¦æ­£ç¡®æ¿€æ´»
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. ç¡¬ä»¶èµ„æºæ˜¯å¦å……è¶³

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œå¯è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹ã€‚

---

**å¼€å‘å›¢é˜Ÿ**ï¼šå‘¨å­èˆª
**é€‚ç”¨è¯¾é¢˜**ï¼šç—…æ¯’ç»„ç ”ç©¶æ–¹å‘  
**æ›´æ–°æ—¶é—´**ï¼š2025å¹´12æœˆ  
**GitHub**ï¼šhttps://github.com/Tonystarkw12/virus-demo-pipeline
